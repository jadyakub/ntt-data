<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NTT NOC — Login</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<meta name="theme-color" content="#4338ca">
<style>
  :root{ --ink:#0b1020; --brand:#4338ca; --kb:0px; }
  body{ font-family:'Inter','Segoe UI',system-ui,-apple-system,Arial,sans-serif; background:var(--ink); color:#111827; }

  .mi{ font-family:'Material Symbols Rounded'; font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24; }
  .chip{ font-size:12px; padding:.25rem .6rem; border-radius:999px; }

  /* Aurora */
  .aurora{ position:fixed; inset:0; overflow:hidden; z-index:0; }
  .blob{ position:absolute; border-radius:50%; filter:blur(70px); opacity:.42; mix-blend:screen; animation:float 26s ease-in-out infinite; }
  .b1{ width:48vmax;height:48vmax;background:#4f46e5; left:-10vmax; top:-12vmax; }
  .b2{ width:50vmax;height:50vmax;background:#059669; right:-12vmax; bottom:-14vmax; animation-delay:-9s; }
  .b3{ width:36vmax;height:36vmax;background:#22d3ee; left:32%; top:58%; animation-delay:-14s; }
  @keyframes float{0%,100%{transform:translate3d(0,0,0) scale(1)}50%{transform:translate3d(-2%,3%,0) scale(1.05)}}

  /* Card */
  .glass{
    background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.82));
    backdrop-filter:blur(14px); -webkit-backdrop-filter:blur(14px);
    border-radius:20px; border:1px solid rgba(255,255,255,.6);
    box-shadow:0 22px 70px rgba(0,0,0,.3); position:relative;
  }
  .glass:before{
    content:""; position:absolute; inset:-1.4px; border-radius:inherit; pointer-events:none;
    background:conic-gradient(from 210deg at 50% 50%, #a5b4fc, #22d3ee, #10b981, #4f46e5, #a78bfa, #a5b4fc);
    mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite:xor; mask-composite:exclude; padding:1.4px; opacity:.9;
  }

  .brand-badge{ width:3rem;height:3rem;border-radius:12px;background:linear-gradient(135deg,#6366f1,#22d3ee); box-shadow:0 8px 24px rgba(79,70,229,.35); display:grid; place-items:center; color:#fff; }

  /* Segmented role */
  .seg{ display:grid; grid-template-columns:1fr 1fr; gap:8px; padding:6px; border-radius:12px; background:#eef2ff; border:1px solid #c7d2fe; }
  .seg>button{ border-radius:10px; padding:.7rem .9rem; display:flex; align-items:center; justify-content:center; gap:.5rem; font-weight:700; color:#374151; }
  .seg>button[aria-pressed="true"]{ background:#4338ca; color:#fff; box-shadow:0 8px 24px rgba(67,56,202,.35); transform:translateY(-1px); }

  /* Inputs */
  .input{ width:100%; padding:.95rem 1rem .95rem 2.6rem; border-radius:12px; border:1px solid #d1d5db; background:#fff; outline:none; transition:border-color .15s, box-shadow .15s; }
  .input:focus{ border-color:#6366f1; box-shadow:0 0 0 3px rgba(99,102,241,.25); }
  .peek{ position:absolute; right:.45rem; top:50%; transform:translateY(-50%); padding:.4rem .55rem; border-radius:8px; }
  .hint{ font-size:11px; color:#6b7280; }
  .err{ font-size:12px; color:#dc2626; }

  /* Keyboard-safe state */
  body.kb-open main{ align-items:start; }
  body.kb-open .glass{ translate:0 0; } /* biar natural, scroll yg jaga posisi */

  /* ===== Mobile tweaks ===== */
  @media (max-width: 640px){
    main{ min-height: 100dvh; padding: 12px; }
    header .chip{ font-size:11px; }
    .glass{ border-radius:16px; }
    .glass>.pad{ padding:18px; }
    .brand-badge{ width:2.6rem; height:2.6rem; border-radius:10px; }
    .seg{ grid-template-columns:1fr; }
    .seg>button{ padding:.85rem .9rem; }
    .input{ padding-left:2.4rem; }
    .b1{ width:80vmin;height:80vmin; left:-30vmin; top:-22vmin; }
    .b2{ width:86vmin;height:86vmin; right:-36vmin; bottom:-40vmin; }
    .b3{ width:60vmin;height:60vmin; left:18vmin; top:56vmin; }
  }
</style>
</head>
<body>

<!-- Aurora background -->
<div class="aurora">
  <div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div>
</div>

<!-- Top bar: only status chip (brand bar removed) -->
<header class="absolute inset-x-0 top-0 z-10">
  <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-end text-white/90">
    <span id="netState" class="chip bg-white/20 backdrop-blur border border-white/30">Checking network…</span>
  </div>
</header>

<main class="relative z-10 min-h-screen grid place-items-center px-5">
  <div class="w-full max-w-md glass">
    <div class="pad p-6 md:p-8">
      <!-- Brand inside card -->
      <div class="flex items-center gap-3 mb-4">
        <div class="brand-badge"><span class="mi text-2xl">bolt</span></div>
        <div>
          <h1 class="text-xl font-extrabold text-gray-900 leading-tight">NTT Log Viewer — Pro</h1>
          <p class="text-xs text-gray-600">Log in to continue</p>
        </div>
      </div>

      <!-- Quick resume (only for CM/NFF) -->
      <div id="quickLast" class="hidden mb-4">
        <button id="resumeBtn" class="w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-white/80 hover:bg-white border border-gray-200 font-semibold">
          <span class="mi">person</span><span>Continue as <b id="lastRoleLabel"></b></span>
        </button>
      </div>

      <!-- Role -->
      <div class="mb-4">
        <div class="text-xs font-semibold text-gray-700 mb-2">Choose Role</div>
        <div class="seg" role="tablist" aria-label="Role">
          <button id="btnCM"  role="tab" aria-selected="true" aria-pressed="true"  data-role="cm"><span class="mi">groups</span> CM Team</button>
          <button id="btnNFF" role="tab" aria-selected="false" aria-pressed="false" data-role="nff"><span class="mi">workspace_premium</span> NFF Team</button>
        </div>
        <div class="mt-1 text-[11px] text-gray-600">
          CM Team: read-only + NTT assignment (pool). NFF Team: full admin.
        </div>
      </div>

      <!-- Password -->
      <form id="loginForm" class="space-y-3">
        <div>
          <div class="flex items-center justify-between">
            <label class="text-xs font-semibold text-gray-700">Password</label>
            <a href="#" class="text-xs text-indigo-600 hover:underline">Forgot?</a>
          </div>
          <div class="relative">
            <span class="mi absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">lock</span>
            <input id="passcode" type="password" class="input" placeholder="••••••••" autocomplete="current-password">
            <button type="button" id="togglePeek" class="peek hover:bg-gray-100">
              <span class="mi text-gray-700">visibility</span>
            </button>
          </div>
          <div class="hint mt-1">Press <b>Enter</b> to log in.</div>
          <div id="err" class="err mt-2 hidden">Wrong password. Please try again.</div>
        </div>

        <div class="flex items-center justify-between">
          <label class="text-sm text-gray-700 flex items-center gap-2">
            <input id="remember" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
            Remember this device
          </label>
          <span class="text-sm text-gray-400">&nbsp;</span>
        </div>

        <!-- SINGLE guest button -->
        <button id="guestBtn" type="button"
          class="w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-white/85 hover:bg-white border border-gray-200 font-semibold">
          <span class="mi">visibility</span> Continue as Guest (read-only)
        </button>
      </form>

      <div class="mt-6 text-[11px] leading-relaxed text-gray-600">
        This system may log activity for operational purposes and for managing NTT for the CM Team.
      </div>
    </div>
  </div>

  <footer class="mt-6 text-xs text-white/85 text-center px-3" style="padding-bottom:calc(env(safe-area-inset-bottom) + 8px)">
    © 2025 NTT Log Viwer • v1.0 | Build by Mohd Aizad Yakub •  NFF PBPS
  </footer>
</main>

<script>
  const CM_PASSWORD  = 'cmteam';
  const NFF_PASSWORD = 'nffteam';

  const qs=(s,r=document)=>r.querySelector(s);
  const qsa=(s,r=document)=>[...r.querySelectorAll(s)];
  const fromQS = new URLSearchParams(location.search);
  const redirectTo = decodeURIComponent(fromQS.get('to')||'index.html');

  // Net badge
  function setNetBadge(){
    const el = qs('#netState');
    if(navigator.onLine){ el.textContent='Online'; el.className='chip bg-emerald-500/90 text-white'; }
    else{ el.textContent='Offline mode'; el.className='chip bg-amber-500/90 text-white'; }
  }
  addEventListener('online', setNetBadge); addEventListener('offline', setNetBadge); setNetBadge();

  // Role segmented
  let selectedRole='cm';
  function choose(role){
    selectedRole = role;
    const cm=qs('#btnCM'), nff=qs('#btnNFF');
    const map={cm,nff};
    Object.entries(map).forEach(([k,btn])=>{
      const on=(k===role); btn.setAttribute('aria-selected',on?'true':'false'); btn.setAttribute('aria-pressed',on?'true':'false');
    });
    qs('#passcode').focus();
  }
  qs('#btnCM').addEventListener('click',()=>choose('cm'));
  qs('#btnNFF').addEventListener('click',()=>choose('nff'));
  qsa('[role="tab"]').forEach(b=>b.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight'||e.key==='ArrowLeft'){ e.preventDefault(); choose(selectedRole==='cm'?'nff':'cm'); }
  }));

  // Peek password
  qs('#togglePeek').onclick=()=>{
    const i=qs('#passcode'); const isPw=i.type==='password'; i.type=isPw?'text':'password';
    qs('#togglePeek').innerHTML=`<span class="mi text-gray-700">${isPw?'visibility_off':'visibility'}</span>`; i.focus();
  };

  // Quick resume only for CM/NFF (not guest)
  const lastAuth = localStorage.getItem('auth');
  if(lastAuth==='cm' || lastAuth==='nff'){
    qs('#lastRoleLabel').textContent = lastAuth==='cm' ? 'CM TEAM' : 'NFF TEAM';
    qs('#quickLast').classList.remove('hidden');
    qs('#resumeBtn').onclick = ()=> location.href = redirectTo;
  }

  // Guest view-only  >>> UPDATED: role='cm'
  qs('#guestBtn').onclick=()=>{
    localStorage.setItem('role','cm');          // was 'tech'
    localStorage.setItem('auth','guest');
    localStorage.setItem('guest','1');
    location.href = redirectTo;
  };

  // Submit via Enter (no button)
  qs('#loginForm').addEventListener('submit', e=>{ e.preventDefault(); doLogin(); });
  qs('#passcode').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); doLogin(); }});

  function doLogin(){
    const pass = qs('#passcode').value.trim();
    const remember = qs('#remember').checked;
    const err = qs('#err');

    if(!pass) return invalid();
    if(selectedRole==='cm'  && pass!==CM_PASSWORD) return invalid();
    if(selectedRole==='nff' && pass!==NFF_PASSWORD) return invalid();

    if(selectedRole==='cm'){
      localStorage.setItem('role','cm');        // was 'tech'
      localStorage.setItem('auth','cm');
      localStorage.setItem('cm_perms','assignment_only');
      localStorage.removeItem('guest');
    }else{
      localStorage.setItem('role','nff');       // was 'admin'
      localStorage.setItem('auth','nff');
      localStorage.removeItem('guest');
      localStorage.removeItem('cm_perms');
    }

    if(remember){ localStorage.setItem('remember_device','1'); } else { localStorage.removeItem('remember_device'); }
    location.href = redirectTo;

    function invalid(){
      err.classList.remove('hidden');
      const field = qs('#passcode'); field.style.borderColor='#fca5a5'; field.focus(); shake();
    }
  }

  // ===== Keyboard-safe logic (iOS/Android) =====
  (function keyboardSafe(){
    const card = document.querySelector('.glass');
    const main = document.querySelector('main');
    const vv = window.visualViewport;

    function apply(kb){
      document.documentElement.style.setProperty('--kb', kb + 'px');
      if(kb > 80){
        document.body.classList.add('kb-open');
        main.style.paddingBottom = (kb + 24) + 'px';
        setTimeout(()=>{ card.scrollIntoView({block:'center', behavior:'smooth'}); }, 50);
      }else{
        document.body.classList.remove('kb-open');
        main.style.paddingBottom = '';
      }
    }

    function onChange(){
      const kb = vv ? Math.max(0, window.innerHeight - vv.height) : 0;
      apply(kb);
    }

    if(vv){
      vv.addEventListener('resize', onChange);
      vv.addEventListener('scroll',  onChange);
    }
    window.addEventListener('orientationchange', onChange);
    window.addEventListener('focusin', onChange);
    window.addEventListener('focusout', onChange);

    onChange();
  })();

  function shake(){
    const el=document.querySelector('.glass');
    el.animate(
      [{transform:'translateX(0)'},{transform:'translateX(-6px)'},{transform:'translateX(6px)'},
       {transform:'translateX(-4px)'},{transform:'translateX(4px)'},{transform:'translateX(0)'}],
      {duration:320,easing:'ease-in-out'}
    );
  }

  // Focus on load
  addEventListener('load', ()=> qs('#passcode').focus());
</script>
</body>
</html>
